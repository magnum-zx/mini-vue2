{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["export function observe(data) {\r\n\t// 只针对对象劫持\r\n\tif (typeof data !== 'object' || data === null) {\r\n\t\treturn\r\n\t}\r\n\t// 如果一个对象以及被劫持过了，就不需要再次劫持，通过添加__ob__判断\r\n\treturn new Observer(data)\r\n}\r\n\r\nexport function defineReactive(target, key, value) {\r\n\tobserve(value)\r\n\tObject.defineProperty(target, key, {\r\n\t\tget() {\r\n\t\t\treturn value\r\n\t\t},\r\n\t\tset(newValue) {\r\n\t\t\tif (newValue === value) return\r\n\t\t\tobserve(newValue) // 如果newValue是个对象，需要再次劫持\r\n\t\t\tvalue = newValue\r\n\t\t},\r\n\t})\r\n}\r\n\r\nclass Observer {\r\n\tconstructor(data) {\r\n\t\t// Object.defineProperty只能劫持已存在的属性（因此需要增加api如 Vue.$set，Vue.$delete等）\r\n\t\tif (!data.hasOwnProperty('__ob__')) {\r\n\t\t\t// data.__ob__ = this\r\n\t\t\tObject.defineProperty(data, '__ob__', {\r\n\t\t\t\tvalue: this,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (Array.isArray(data)) {\r\n\t\t\t//\r\n\t\t} else {\r\n\t\t\tthis.walk(data) // 遍历属性\r\n\t\t}\r\n\t}\r\n\r\n\twalk(data) {\r\n\t\t// 重写对象属性\r\n\t\tObject.keys(data).forEach((key) => defineReactive(data, key, data[key]))\r\n\t}\r\n\tobserveArray(data) {\r\n\t\tdata.forEach((item) => observe(item))\r\n\t}\r\n}\r\n","import { observe } from './observe'\r\n\r\nexport function initState(vm) {\r\n\tconst opts = vm.$options\r\n\tif (opts.data) {\r\n\t\tinitData(vm)\r\n\t}\r\n}\r\n\r\nfunction initData(vm) {\r\n\tlet data = vm.$options.data // data可能是函数或者对象\r\n\tdata = typeof data === 'function' ? data.call(vm) : data\r\n\tvm._data = data // 将data挂载到vm上\r\n\r\n\t// 观测数据： 采用Object.defineProperty对数据进行劫持\r\n\tobserve(data)\r\n\r\n\t// 将vm._data 用vm代理\r\n\tfor (let key in data) {\r\n\t\tproxy(vm, '_data', key)\r\n\t}\r\n}\r\n\r\nfunction proxy(vm, target, key) {\r\n\tObject.defineProperty(vm, key, {\r\n\t\tget() {\r\n\t\t\treturn vm[target][key]\r\n\t\t},\r\n\t\tset(newValue) {\r\n\t\t\tif (vm[target][key] === newValue) return\r\n\t\t\tvm[target][key] = newValue\r\n\t\t},\r\n\t})\r\n}\r\n","export function compileToFunction(template) {\r\n\tconsole.log(template)\r\n}\r\n","// 做一些初始化操作\r\nimport { initState } from './state.js'\r\nimport { compileToFunction } from './compiler'\r\nexport function initMixin(Vue) {\r\n\tVue.prototype._init = function (options) {\r\n\t\t// vm.$options 就是获取用户的配置\r\n\t\tconst vm = this\r\n\t\tvm.$options = options // 将用户的options 挂载到实例上\r\n\r\n\t\t// 初始化状态\r\n\t\tinitState(vm)\r\n\r\n\t\tif (options.el) {\r\n\t\t\tvm.$mount(options.el)\r\n\t\t}\r\n\t}\r\n\r\n\tVue.prototype.$mount = function (el) {\r\n\t\tconst vm = this\r\n\t\tel = document.querySelector(el)\r\n\t\tlet ops = vm.$options\r\n\t\tif (!ops.render) {\r\n\t\t\tlet template\r\n\t\t\tif (!ops.template && el) {\r\n\t\t\t\t// 没有template 但是有 el\r\n\t\t\t\ttemplate = el.outerHTML\r\n\t\t\t} else if (el) {\r\n\t\t\t\ttemplate = ops.template\r\n\t\t\t}\r\n\r\n\t\t\tif (template) {\r\n\t\t\t\tconst render = compileToFunction(template)\r\n\t\t\t\tops.render = render\r\n\t\t\t}\r\n\t\t\t// console.log(template)\r\n\t\t}\r\n\r\n\t\t// script 标签引用的vue.global.js 编译过程是在浏览器\r\n\t\t// runtime 不包含模板语法，整个编译是打包的时候通过loader转义.vue文件的\r\n\t}\r\n}\r\n","// 打包入口文件\r\n\r\nimport { initMixin } from './init'\r\n\r\nfunction Vue(options) {\r\n\tthis._init(options)\r\n}\r\n\r\ninitMixin(Vue) // 扩展init方法\r\n\r\nexport default Vue\r\n"],"names":["observe","data","Observer","defineReactive","target","key","value","Object","defineProperty","get","set","newValue","hasOwnProperty","enumerable","Array","isArray","walk","keys","forEach","item","initState","vm","opts","$options","initData","call","_data","proxy","compileToFunction","template","console","log","initMixin","Vue","prototype","_init","options","el","$mount","document","querySelector","ops","render","outerHTML"],"mappings":"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"}